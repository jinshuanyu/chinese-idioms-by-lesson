<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç”Ÿå­—ğŸ”—ç­†é †ç·´ç¿’ğŸ”—æˆèª</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root{
      --bg:#fffefb;
      --fg:#1b1b1b;
      --accent:#ff7a59;
      --accent-2:#ffd9cc;
      --muted:#6b7280; 
      --card:#ffffff;
      --border:#e5e7eb;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font:16px/1.6 ui-sans-serif,system-ui,"Noto Sans TC",PingFangTC,"Microsoft JhengHei",sans-serif;}
    header{padding:20px 16px 8px; text-align:center;}
    header h1{margin:0; font-size:22px; letter-spacing:.5px;}
    header p.sub{margin:6px 0 0; color:var(--muted); font-size:14px;}
    .container{max-width:960px; margin:0 auto; padding:16px;}
    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,.04);}
    .row{display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-bottom:14px;}
    label{font-weight:600; margin-right:6px;}
    /* ä¸‹æ‹‰é¸å–®å­—é«”åŠ å¤§ */
    select{min-width:140px; padding:8px 10px; border-radius:12px; border:1px solid var(--border); background:#fff; font-size:18px;}
    #meta{margin:10px 0 6px; font-size:15px;}
    #meta a{color:#0d6efd; text-decoration:none; border-bottom:1px dotted #9bbcff;}
    #meta .note{color:var(--muted); font-size:13px; margin-left:6px;}
    /* åªæ”¾å¤§ï¼šğŸ“– èª²åï¼ˆæ•™è‚²ç™¾ç§‘ï¼‰ & âœï¸ ç­†é †ç·´ç¿’ï¼ˆdictView.jspï¼‰ */
    #meta a[href*="TCollection?TextNameId="],
    #meta a[href*="dictView.jsp"]{
      font-size:20px;
      font-weight:700;
      line-height:1.6;
    }

    /* è¡¨æ ¼èˆ‡æ¬„ä½èª¿æ•´ */
    table{width:100%; border-collapse:collapse; margin-top:8px;}
    th, td{border-bottom:1px solid var(--border); padding:10px 8px; text-align:left;}
    th{background:#fff; position:sticky; top:0;}
    /* ç”Ÿå­—æ¬„æ›´çª„ã€å­—å†å¤§ä¸€é»é» */
    #result th:first-child{width:6rem;}
    #result td.char{font-size:24px; font-weight:700; letter-spacing:2px; white-space:nowrap;}
    /* æˆèªæ¬„åƒå‰©é¤˜å¯¬åº¦ã€å­—é«”æ›´å¤§ */
    #result thead th{ font-size:17px; }
    #result td.idioms{font-size:20px; line-height:1.9;}

    td a{color:#0d6efd; text-decoration:none;}
    .muted{color:var(--muted); font-size:12px;}
    footer{max-width:960px; margin:12px auto 36px; padding:0 16px; text-align:center;}
    .pill{display:inline-block; background:var(--accent-2); color:#9a3412; padding:2px 8px; border-radius:999px; font-size:12px; margin-left:6px;}
  </style>
</head>
<body>
  <header>
    <h1>ç”Ÿå­—ğŸ”—ç­†é †ç·´ç¿’ğŸ”—æˆèª</h1>
    <p class="sub">â¬ é¸ <b>å­¸æœŸ</b> â†’ <b>å¹´ç´š</b> â†’ <b>ç‰ˆæœ¬</b> â†’ <b>èª²åˆ¥</b> <br> ğŸ” æŸ¥çœ‹ç”Ÿå­—çš„<b>ç­†é †</b>å’Œ<b>æˆèª</b>é€£çµ</p>
  </header>

  <div class="container">
    <div class="card">
      <div class="row">
        <select id="term"></select>
        <select id="grade"></select>
        <select id="publisher"></select>
        <select id="lesson"></select>
        <span id="stats" class="pill"></span>
      </div>

      <div id="meta"></div>

      <table id="result">
        <thead>
          <tr><th>ç”Ÿå­—</th><th>ã€Šæˆèªå…¸ã€‹</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

<footer id="legal" class="credits leading-snug" style="border-top:0; text-align:center; padding:16px 12px;">
  <!-- ä¾†æºè‡´è¬ï¼ˆå†å°ä¸€é»ï¼Œé¿å…æ¶ç‰ˆé¢ï¼‰ -->
  <div style="margin-top:12px; font-size:12px; line-height:1.6; color:#555;">
    ç”Ÿå­—æ¸…å–®ä¾†è‡ª
    <a href="https://pedia.cloud.edu.tw/Home/CopyRight" target="_blank" rel="noopener">æ•™è‚²é›²ã€Œæ•™è‚²ç™¾ç§‘ã€</a>ï¼›
    æˆèªæª¢ç´¢é€£çµè‡³
    <a href="https://dict.idioms.moe.edu.tw/pageView.jsp?ID=44&la=0&webMd=2" target="_blank" rel="noopener">æ•™è‚²éƒ¨ã€Šæˆèªå…¸ã€‹</a>
    ï¼ˆ<a href="https://language.moe.gov.tw/001/Upload/Files/site_content/M0001/respub/idiomsdict_10409.pdf" target="_blank" rel="noopener">æˆæ¬Šæ¢æ¬¾</a>ï¼‰ï¼›
    ç­†é †ç·´ç¿’é€£çµè‡³
    <a href="https://stroke-order.learningweb.moe.edu.tw/page.jsp?ID=52" target="_blank" rel="noopener">æ•™è‚²éƒ¨ã€Šåœ‹å­—æ¨™æº–å­—é«”ç­†é †å­¸ç¿’ç¶²ã€‹</a>ã€‚
    å„é€£çµé å…§å®¹èˆ‡æ¬Šåˆ©çš†å±¬åŸç¶²ç«™æ‰€æœ‰ã€‚
  </div>
  <!-- åªç¸®å°é€™ä¸€è¡Œçš„å­— -->
  <div style="font-size:12px; line-height:1.6;">
    Â© 2025 Christina Yu. All rights reserved.
  </div>

  <!-- Iconsï¼šå°ºå¯¸ç…§èˆŠï¼ˆfa-2xï¼‰ï¼Œä¸å—ä¸Šé¢ç¸®å°å½±éŸ¿ -->

    <div style="margin-top:10px;">
  <a href="https://www.mamahowma.com/2025/09/Chinesestrokesidiomsbylesson.html" target="_blank" rel="noopener" aria-label="Info"><i class="fa-solid fa-circle-info fa-xl fa-fw"></i></a>ã€€<a href="mailto:mamahowma@gmail.com" aria-label="Email"><i class="fa-solid fa-envelope fa-xl fa-fw"></i></a>ã€€<a href="https://www.facebook.com/mamahowma" target="_blank" rel="noopener" aria-label="Facebook"><i class="fa-brands fa-facebook fa-xl fa-fw"></i></a>ã€€<a href="https://portaly.cc/mamahowma/support" target="_blank" rel="noopener" aria-label="Support"><i class="fa-solid fa-mug-hot fa-xl fa-fw"></i></a>
</div>



</footer>

<style>
  #legal{margin-top:16px;padding-top:12px;border-top:1px dashed #ddd;color:#555}
  #legal small{font-size:12px;line-height:1.6}
  #legal a{text-decoration:underline}
</style>

<script>
// ===== è¨­å®šï¼šå­¸æœŸã€å‡ºç‰ˆå•†ã€å¹´ç´šç¢¼ =====
const TERMS = [
  { label:"114 å­¸å¹´ä¸Šå­¸æœŸ", code:"11401" }
];
const PUB_CODE = { "å—ä¸€":"0102", "åº·è»’":"0103", "ç¿°æ—":"0101" };
const GRADE_CODE = { "ä¸€å¹´ç´š":"01","äºŒå¹´ç´š":"02","ä¸‰å¹´ç´š":"03","å››å¹´ç´š":"04","äº”å¹´ç´š":"05","å…­å¹´ç´š":"06" };

// ===== CATALOGï¼šå®Œæ•´ä½”ä½ï¼ˆå‘½åè¦ç¯„ï¼šdata/11401/data_11401_<å‡ºç‰ˆç¤¾>_<å¹´ç´š>.jsonï¼‰ =====
const CATALOG = {
  "114 å­¸å¹´ä¸Šå­¸æœŸ": {
    "ä¸€å¹´ç´š": {
      "åº·è»’": "data/11401/data_11401_åº·è»’_ä¸€å¹´ç´š.json",
      "å—ä¸€": "data/11401/data_11401_å—ä¸€_ä¸€å¹´ç´š.json",
      "ç¿°æ—": "data/11401/data_11401_ç¿°æ—_ä¸€å¹´ç´š.json"
    },
    "äºŒå¹´ç´š": {
      "åº·è»’": "data/11401/data_11401_åº·è»’_äºŒå¹´ç´š.json",
      "å—ä¸€": "data/11401/data_11401_å—ä¸€_äºŒå¹´ç´š.json",
      "ç¿°æ—": "data/11401/data_11401_ç¿°æ—_äºŒå¹´ç´š.json"
    },
    "ä¸‰å¹´ç´š": {
      "åº·è»’": "data/11401/data_11401_åº·è»’_ä¸‰å¹´ç´š.json",
      "å—ä¸€": "data/11401/data_11401_å—ä¸€_ä¸‰å¹´ç´š.json",
      "ç¿°æ—": "data/11401/data_11401_ç¿°æ—_ä¸‰å¹´ç´š.json"
    },
    "å››å¹´ç´š": {
      "åº·è»’": "data/11401/data_11401_åº·è»’_å››å¹´ç´š.json",
      "å—ä¸€": "data/11401/data_11401_å—ä¸€_å››å¹´ç´š.json",
      "ç¿°æ—": "data/11401/data_11401_ç¿°æ—_å››å¹´ç´š.json"
    },
    "äº”å¹´ç´š": {
      "åº·è»’": "data/11401/data_11401_åº·è»’_äº”å¹´ç´š.json",
      "å—ä¸€": "data/11401/data_11401_å—ä¸€_äº”å¹´ç´š.json",
      "ç¿°æ—": "data/11401/data_11401_ç¿°æ—_äº”å¹´ç´š.json"
    },
    "å…­å¹´ç´š": {
      "åº·è»’": "data/11401/data_11401_åº·è»’_å…­å¹´ç´š.json",
      "å—ä¸€": "data/11401/data_11401_å—ä¸€_å…­å¹´ç´š.json",
      "ç¿°æ—": "data/11401/data_11401_ç¿°æ—_å…­å¹´ç´š.json"
    }
  }
};

// ===== å·¥å…·å‡½å¼ =====
const $ = sel => document.querySelector(sel);
function termCode(label){ const t=TERMS.find(x=>x.label===label); return t ? t.code : ""; }
function parseTerm(label){
  if(!label) return {year:0, sem:1};
  let idx = label.indexOf('å­¸å¹´åº¦');
  if(idx < 0) idx = label.indexOf('å­¸å¹´'); // å…¼å®¹ã€Œå­¸å¹´ã€å¯«æ³•
  const year = idx>0 ? parseInt(label.slice(0, idx).trim(), 10) : 0;
  const sem = (label.includes('ä¸Šå­¸æœŸ')||label.includes('ç¬¬ä¸€å­¸æœŸ')) ? 1 : 2;
  return {year, sem};
}
function termsSortedDesc(){
  return TERMS.map(t=>t.label).sort((a,b)=>{
    const A=parseTerm(a), B=parseTerm(b);
    if(B.year!==A.year) return B.year-A.year;
    return B.sem-A.sem;
  });
}
function lessonNo2(label){
  // ç‰¹ä¾‹è™•ç†ã€Œé­”æ³•æ–‡å­—ã€ç•¶ç¬¬ 0 èª²
  if(label.includes("é­”æ³•æ–‡å­—")) return '00';
  const m = label.match(/^ç¬¬(\d{1,2})èª²/);
  return m ? m[1].padStart(2,'0') : '01';
}

function idiomLink(ch){ return `https://dict.idioms.moe.edu.tw/idiomList.jsp?idiom=${encodeURIComponent(ch)}`; }
function expectedLessonsCount(grade, pub){
  if(grade==='ä¸€å¹´ç´š'){ return (pub==='åº·è»’') ? 6 : 7; }
  return 12;
}
function pediaId(termLabel, gradeLabel, pubLabel, lessonLabel){
  const pub = PUB_CODE[pubLabel] || "";
  const grade = GRADE_CODE[gradeLabel] || "";
  const tcode = termCode(termLabel) || "";
  const les = lessonNo2(lessonLabel);
  return `${pub}${grade}${tcode}${les}`;
}

// ===== è¼‰å…¥ JSONï¼ˆç„¡ FALLBACK ç”Ÿå­—ï¼›æŠ“ä¸åˆ°å°±å›ç©ºç‰©ä»¶ï¼‰ =====
const CACHE = new Map();
async function ensureDataset(term, grade, pub){
  const key = `${term}|${grade}|${pub}`;
  if(CACHE.has(key)) return CACHE.get(key);
  let data = {};
  const url = (CATALOG?.[term]?.[grade]?.[pub]) || (CATALOG?.[termCode(term)]?.[grade]?.[pub]);
  if(url){
    try{
      const res = await fetch(encodeURI(url), {cache:'no-cache'});
      if(res.ok) data = await res.json();
    }catch(e){}
  }
  CACHE.set(key, data);
  return data;
}

// ===== UIï¼šåˆå§‹åŒ–èˆ‡äº‹ä»¶ =====
function resetSelect(id){ $(id).innerHTML = '<option value="">â€”</option>'; }

function init(){
  const termSel = $('#term');
  termSel.innerHTML = termsSortedDesc().map(x=>`<option>${x}</option>`).join('');
  termSel.value = "114 å­¸å¹´ä¸Šå­¸æœŸ";
  updateGrades();
}

function updateGrades(){
  resetSelect('#grade'); resetSelect('#publisher'); resetSelect('#lesson');
  $('#meta').textContent=''; $('#stats').textContent='';
  const term=$('#term').value;
  const grades = term ? Object.keys(CATALOG[term] || CATALOG[termCode(term)] || {}) : [];
  $('#grade').innerHTML = '<option value="">â€” è«‹é¸æ“‡å¹´ç´š â€”</option>' + grades.map(g=>`<option>${g}</option>`).join('');
}

function updatePublishers(){
  resetSelect('#publisher'); resetSelect('#lesson');
  $('#meta').textContent=''; $('#stats').textContent='';
  const term=$('#term').value, grade=$('#grade').value;
  const pubs = (term && grade) ? Object.keys((CATALOG[term] || CATALOG[termCode(term)] || {})[grade] || {}) : [];
  $('#publisher').innerHTML = '<option value="">â€” è«‹é¸æ“‡ç‰ˆæœ¬ â€”</option>' + pubs.map(p=>`<option>${p}</option>`).join('');
}

async function updateLessons(){
  resetSelect('#lesson'); $('#meta').textContent=''; $('#stats').textContent='';
  const term=$('#term').value, grade=$('#grade').value, pub=$('#publisher').value;
  if(!term || !grade || !pub) return;
  const data = await ensureDataset(term, grade, pub);
  window.CURRENT_DATA = data;
  let lessons = Object.keys(data||{});
  if(!lessons.length){
    const n = expectedLessonsCount(grade, pub);
    lessons = Array.from({length:n}, (_,i)=>`ç¬¬${String(i+1).padStart(2,'0')}èª²`);
  }
  lessons.sort((a,b)=> (parseInt(lessonNo2(a),10) - parseInt(lessonNo2(b),10)) );
  $('#lesson').innerHTML = '<option value="">â€” è«‹é¸æ“‡èª²åˆ¥ â€”</option>' + lessons.map(l=>`<option>${l}</option>`).join('');
}

function render(){
  const term=$('#term').value, grade=$('#grade').value, pub=$('#publisher').value, les=$('#lesson').value;
  $('#result tbody').innerHTML='';
  if(!term || !grade || !pub || !les) { $('#meta').textContent=''; $('#stats').textContent=''; return; }

  const chars = (window.CURRENT_DATA||{})[les] || [];
  const id = pediaId(term, grade, pub, les);
  const lessonURL = `https://pedia.cloud.edu.tw/Bookmark/TCollection?TextNameId=${id}`;

  // ä¸Šæ–¹è³‡è¨Šåˆ—ï¼ˆå…ˆæ”¾èª²åé€£çµèˆ‡ä¾†æºèªªæ˜ï¼‰
  $('#meta').innerHTML =
    `<strong>${term}</strong>ï½œ<strong>${grade}</strong>ï½œ<strong>${pub}</strong>
     <br><a href="${lessonURL}" target="_blank" rel="noopener">ğŸ“– ${les}</a>
     <br><span class="note">ã€Šæ•™è‚²ç™¾ç§‘ã€‹ç”Ÿå­—è©å½™è¡¨</span>`;

  // âœï¸ ç­†é †ç·´ç¿’ï¼šæœ‰ç”Ÿå­—æ‰é¡¯ç¤ºï¼›ä½¿ç”¨ dictView.jsp ç›´å…¥ç”Ÿå­—ç·´ç¿’å™¨ï¼ˆé€å­—æ¨¡å¼ã€1 æ¬¡ï¼‰
  if (Array.isArray(chars) && chars.length){
    const allChars = chars.join('');
    const firstId  = allChars.codePointAt(0); // é¦–å­— Unicode åé€²ä½
    const strokeURL = `https://stroke-order.learningweb.moe.edu.tw/dictView.jsp?ID=${firstId}&WORD=${encodeURIComponent(allChars)}&ID2=1&TP=0`;
    $('#meta').insertAdjacentHTML(
      'beforeend',
      `<br><a href="${strokeURL}" target="_blank" rel="noopener">âœï¸ ç­†é †ç·´ç¿’</a>
       <span class="note">ï¼ˆç”Ÿå­—ç·´ç¿’å™¨ï¼‰</span>`
    );
  }

  // çµ±è¨ˆ
  $('#stats').textContent = chars.length ? `ã€€å…± ${chars.length} å€‹ç”Ÿå­—` : '';

  // è¡¨æ ¼ï¼šç”Ÿå­—ï¼‹æˆèªå…¸
  const tbody = $('#result tbody');
  for(const ch of chars){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td class="char">${ch}</td>
                    <td class="idioms"><a href="${idiomLink(ch)}" target="_blank" rel="noopener">æˆèªæª¢ç´¢ã€Œ${ch}ã€</a></td>`;
    tbody.appendChild(tr);
  }
}

// ç¶å®š
$('#term').addEventListener('change', ()=>{ updateGrades(); });
$('#grade').addEventListener('change', ()=>{ updatePublishers(); });
$('#publisher').addEventListener('change', async ()=>{ await updateLessons(); });
$('#lesson').addEventListener('change', render);

// å•Ÿå‹•
init();
</script>
</body>
</html>
