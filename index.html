<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>åœ‹å°åœ‹èªç”Ÿå­— Ã— æˆèªå…¸é€£çµ</title>
  <style>
    :root{
      --bg1:#fff9f5;--bg2:#f7fcff;--panel:#ffffff;--text:#1f2937;--muted:#64748b;
      --accent:#ff7ac3;--accent2:#60a5fa;--accent3:#fbbf24;--border:#e2e8f0;--stripe:#fff3f8;
    }
    *{box-sizing:border-box}
    body{font:17px/1.65 system-ui,"Noto Sans TC",sans-serif;margin:0;padding:24px;min-height:100vh;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--text)}
    .wrap{max-width:980px;margin:auto;background:var(--panel);border:2px solid var(--border);border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(255,122,195,.15)}
    h1{margin:0 0 6px;font-size:26px}
    .sub{margin:0 0 16px;color:var(--muted)}
    label{font-size:14px;color:#334155}
    select{margin-right:8px;padding:10px 12px;border-radius:12px;border:2px solid #ffd4ea;background:#fff;color:#0f172a;font-weight:600}
    select:focus{outline:3px solid #fde1f0}
    .row{margin:10px 0}
    table{width:100%;border-collapse:separate;border-spacing:0;margin-top:12px;border:2px solid var(--border);border-radius:12px;overflow:hidden}
    th,td{border-bottom:1px solid var(--border);padding:10px 8px;text-align:left;vertical-align:top}
    thead th{background:#fff;position:sticky;top:0}
    tbody tr:nth-child(odd){background:var(--stripe)}
    th{color:#0f172a;font-size:15px}
    .pill{display:inline-block;border:2px dashed #ffd4ea;border-radius:999px;padding:6px 12px;margin-top:6px;background:#fff5fb;color:#9d174d}
    .muted{color:var(--muted)}
    a{color:#2563eb;text-decoration:none;font-weight:700}
    a:hover{text-decoration:underline}
    .note{font-size:14px;color:#475569}
  </style>
</head>
<body>
<div class="wrap">
  <h1>åœ‹å°åœ‹èªç”Ÿå­— Ã— æˆèªå…¸é€£çµ</h1>
  <p class="sub">å…ˆé¸ <b>å­¸æœŸ</b> â†’ <b>å¹´ç´š</b> â†’ <b>ç‰ˆæœ¬</b> â†’ <b>èª²åˆ¥</b>ï¼Œå³å¯çœ‹åˆ°è©²èª²æ‰€æœ‰ç”Ÿå­—çš„ã€Šæˆèªå…¸ã€‹æŸ¥è©¢é€£çµèˆ‡æ•™è‚²ç™¾ç§‘é é¢ã€‚</p>

  <div class="row">
    <label>å­¸æœŸï¼š</label>
    <select id="term"></select>
    <label>å¹´ç´šï¼š</label>
    <select id="grade"></select>
    <label>ç‰ˆæœ¬ï¼š</label>
    <select id="publisher"></select>
    <label>èª²åˆ¥ï¼š</label>
    <select id="lesson"></select>
  </div>

  <div id="meta" class="pill"></div>
  <div id="stats" class="muted" style="margin-left:8px"></div>

  <table id="result">
    <thead><tr>
      <th style="width:90px">ç”Ÿå­—</th>
      <th>ã€Šæˆèªå…¸ã€‹æŸ¥è©¢</th>
    </tr></thead>
    <tbody></tbody>
  </table>

  <p class="muted" style="margin-top:10px">
    è³‡æ–™ä¾†æºï¼šæ•™è‚²éƒ¨ã€Šæˆèªå…¸ã€‹ã€æ•™è‚²é›² pediaã€‚<br>
    ï¼ˆæœ¬é åƒ…æä¾›é€£çµèˆ‡è‡ªè¡Œæ•´ç†çš„ç”Ÿå­—åˆ—è¡¨ï¼Œä¸æ“·å–æˆ–é‡è£½æ•™è‚²ç™¾ç§‘ï¼æˆèªå…¸å…§æ–‡ã€‚ï¼‰
  </p>
</div>

<script>
// ===== å¸¸æ•¸èˆ‡è¨­å®šï¼ˆå¯æ“´å……ï¼‰ =====
const PUB_CODE = { "å—ä¸€":"0102", "åº·è»’":"0103", "ç¿°æ—":"0101" };
const GRADE_CODE = { "ä¸€å¹´ç´š":"01","äºŒå¹´ç´š":"02","ä¸‰å¹´ç´š":"03","å››å¹´ç´š":"04","äº”å¹´ç´š":"05","å…­å¹´ç´š":"06" };
const TERMS = [ { label:"114 å­¸å¹´åº¦ä¸Šå­¸æœŸ", code:"11401", folder:"11401" } ];
const CATALOG = {
const CATALOG = {
  "114 å­¸å¹´åº¦ä¸Šå­¸æœŸ": {
    "ä¸€å¹´ç´š": {
      "åº·è»’": "data/11401/data_11401_åº·è»’_ä¸€å¹´ç´š.json",
      "å—ä¸€": "data/11401/data_11401_å—ä¸€_ä¸€å¹´ç´š.json",
      "ç¿°æ—": "data/11401/data_11401_ç¿°æ—_ä¸€å¹´ç´š.json"
    },
    "äºŒå¹´ç´š": {
      "åº·è»’": "data/11401/data_11401_åº·è»’_äºŒå¹´ç´š.json",
      "å—ä¸€": "data/11401/data_11401_å—ä¸€_äºŒå¹´ç´š.json",
      "ç¿°æ—": "data/11401/data_11401_ç¿°æ—_äºŒå¹´ç´š.json"
    },
    "ä¸‰å¹´ç´š": {
      "å—ä¸€": "data/11401/data_11401_å—ä¸€_ä¸‰å¹´ç´š.json"
      // è‹¥ä½ ä¹Ÿå·²ä¸Šå‚³é€™å…©å€‹ï¼Œå°±åŠ ä¸Šï¼š
      // "åº·è»’": "data/11401/data_11401_åº·è»’_ä¸‰å¹´ç´š.json",
      // "ç¿°æ—": "data/11401/data_11401_ç¿°æ—_ä¸‰å¹´ç´š.json"
    }
  }
};


const FALLBACK = {
  "114 å­¸å¹´åº¦ä¸Šå­¸æœŸ|ä¸‰å¹´ç´š|å—ä¸€": {
    "ç¬¬01èª² ä½ å¥½ï¼Œæ–°æœ‹å‹": ["æ³¥","åŒ–","é›€","è¼•","ç¾½","è¡£","è„†","é«®","è™•","æ—…","è¡Œ","å¹³","ç”·","æœ—","è¶³"],
    "ç¬¬02èª² æˆ‘å€‘çš„ç´„å®š": ["å»Š","è¨‚","ç­","ç´š","ç´„","ç´›","æŒ","è¨˜","éŒ„","èŠ","è¨€","çƒˆ","äº›","æ","æ„"],
    "ç¬¬03èª² ä¸‹èª²ååˆ†é˜": ["çŸ­","é˜","é¬¼","é¬§","æº–","æœ","è¹ˆ","è¡¨","æš¢","ç„¡","ç¸½","éŸ¿","å¿˜","ç›¡","è²¬"],
    "ç¬¬04èª² ç•™ä½ä»Šå¤©çš„å¤ªé™½": ["æŒ‡","å¤•","è³½","ç·Š","åº—","é€—","è½‰","éœ²","æ¥­","å°ˆ","å‹","åˆ©","æ‚…","ä¹–","æº«"],
    "ç¬¬05èª² ç«å¤§äº†": ["é¾","æ²–","è±","å…„","å","æ­ª","é˜²","è­¦","éˆ´","æ³¨","å“¡","å‚·","æ­»","è«’","è„¾"],
    "ç¬¬06èª² æˆ‘è©²æ€éº¼è¾¦?": ["å¹•","æ¯","æ’","æµ","æº¼","é€","é›™","èƒ¸","è² ","æ…Œ","é€ƒ","è¾¦","é¡Œ","ç°","å‰ª"],
    "ç¬¬07èª² æœ€å¹´è¼•çš„å¥¶å¥¶": ["èƒŒ","æ–‘","çšº","æ‡‚","å‡¡","æ¢³","å¤¾","è—","æ","æ‘º","ä»”","è—","è¡“","é›–","å‰µ"],
    "ç¬¬08èª² é­”ã€Œé«®ã€å“¥å“¥": ["é­”","åœ","å·¾","è¦–","æ¡†","èª¤","æ„‰","æ•¸","æ¡¶","åˆ€","æ›¾","æ©Ÿ","è§£","é¡","é½Š"],
    "ç¬¬09èª² ç©¿ç™½è¢çš„é†«ç”Ÿä¼¯ä¼¯": ["é†«","ç©¿","è¢","æˆ´","ç­’","å•„","å‚™","å¹¹","æ•²","æ¯’","é«”","æ·˜","è˜‹","èˆ¬","è—¥"],
    "ç¬¬10èª² å”‰å‘€ï¼èª¤æœƒå¤§äº†": ["æ¥µ","ç†Š","é›ª","è…¦","å¯¦","æ ¹","å","å°„","è†š","è±¬","å‘†","å°","è±¡","æ†¶","æ»¾"],
    "ç¬¬11èª² çŸ³è™çš„å‘Šç™½": ["é¡","è™","è²“","è‡º","ç£","ç¨","è¬","ç¥–","è›™","æ‰","é¡","å ","é›","è‚‰","å¨"],
    "ç¬¬12èª² æ˜†èŸ²çš„ä¿å‘½å¦™æ‹›": ["æ˜†","æ”»","æ“Š","æ¼”","ä¿","å‘½","ç¿…","æ•µ","å‘¨","ç«¹","ç¯€","é€¼","æŠ€","é€€","å±"]
  }
};

// ===== å·¥å…·å‡½å¼ï¼ˆé¿å…ç”¨æ­£å‰‡çš„åæ–œç·šï¼‰ =====
const $ = (sel)=>document.querySelector(sel);
function parseTerm(label){
  if(!label) return {year:0, sem:1};
  const idx = label.indexOf('å­¸å¹´åº¦');
  const year = idx>0 ? parseInt(label.slice(0, idx).trim(), 10) : 0;
  let sem = 1;
  if(label.includes('ä¸‹å­¸æœŸ') || label.includes('ç¬¬äºŒå­¸æœŸ')) sem = 2;
  else if(label.includes('ä¸Šå­¸æœŸ') || label.includes('ç¬¬ä¸€å­¸æœŸ')) sem = 1;
  return {year, sem};
}
function termsSortedDesc(){
  return Object.keys(CATALOG).sort((a,b)=>{
    const A=parseTerm(a), B=parseTerm(b);
    if(B.year!==A.year) return B.year-A.year;
    return B.sem-A.sem;
  });
}
function termCode(label){
  const t = TERMS.find(x=>x.label===label);
  return t ? t.code : '';
}
function gradeSorted(grs){
  return (grs||[]).sort((a,b)=> (parseInt(GRADE_CODE[a]||'0') - parseInt(GRADE_CODE[b]||'0')) );
}
function lessonNo2(label){
  const a = label.indexOf('ç¬¬');
  const b = label.indexOf('èª²');
  const s = (a>=0 && b>a) ? label.slice(a+1, b) : '01';
  return s.padStart(2,'0');
}

const CACHE = new Map();
async function ensureDataset(term, grade, pub){
  const key = `${term}|${grade}|${pub}`;
  if(CACHE.has(key)) return CACHE.get(key);
  let data = null;
  const url = CATALOG?.[term]?.[grade]?.[pub];
  if(url){
    try{ const res = await fetch(url); if(res.ok) data = await res.json(); }catch(e){}
  }
  if(!data) data = FALLBACK[key] || {};
  CACHE.set(key, data);
  return data;
}

function pediaId(termLabel, gradeLabel, pubLabel, lessonLabel){
  const pub = PUB_CODE[pubLabel] || '';
  const grade = GRADE_CODE[gradeLabel] || '';
  const tcode = termCode(termLabel) || '';
  const les = lessonNo2(lessonLabel);
  return `${pub}${grade}${tcode}${les}`;
}
function idiomLink(term){ return `https://dict.idioms.moe.edu.tw/idiomList.jsp?idiom=${encodeURIComponent(term)}`; }

// ===== UIï¼šåˆå§‹åŒ–èˆ‡äº‹ä»¶ =====
function resetSelect(id){ $(id).innerHTML = '<option value="">â€”</option>'; }

function init(){
  const terms = termsSortedDesc();
  const termSel = $('#term');
  termSel.innerHTML = terms.map(t=>`<option>${t}</option>`).join('');
  const def = terms[0] || '';
  if(def) termSel.value = def;
  updateGrades();
}

function updateGrades(){
  resetSelect('#grade'); resetSelect('#publisher'); resetSelect('#lesson');
  $('#meta').textContent=''; $('#stats').textContent='';
  const term = $('#term').value;
  const grades = term ? Object.keys(CATALOG[term]||{}) : [];
  const sorted = gradeSorted(grades);
  $('#grade').innerHTML = '<option value="">â€” è«‹é¸æ“‡ â€”</option>' + sorted.map(g=>`<option>${g}</option>`).join('');
}

function updatePublishers(){
  resetSelect('#publisher'); resetSelect('#lesson');
  $('#meta').textContent=''; $('#stats').textContent='';
  const term=$('#term').value, grade=$('#grade').value;
  const pubs = term && grade ? Object.keys(CATALOG[term][grade]||{}) : [];
  $('#publisher').innerHTML = '<option value="">â€” è«‹é¸æ“‡ â€”</option>' + pubs.map(p=>`<option>${p}</option>`).join('');
}

async function updateLessons(){
  resetSelect('#lesson'); $('#meta').textContent=''; $('#stats').textContent='';
  const term=$('#term').value, grade=$('#grade').value, pub=$('#publisher').value;
  if(!term || !grade || !pub) return;
  const data = await ensureDataset(term, grade, pub);
  window.CURRENT_DATA = data;
  const lessons = Object.keys(data||{}).sort((a,b)=> (parseInt(lessonNo2(a),10) - parseInt(lessonNo2(b),10)) );
  $('#lesson').innerHTML = '<option value="">â€” è«‹é¸æ“‡ â€”</option>' + lessons.map(l=>`<option>${l}</option>`).join('');
}

function render(){
  const term=$('#term').value, grade=$('#grade').value, pub=$('#publisher').value, les=$('#lesson').value;
  $('#result tbody').innerHTML='';
  if(!term || !grade || !pub || !les) { $('#meta').textContent=''; $('#stats').textContent=''; return; }
  const chars = (window.CURRENT_DATA||{})[les] || [];
  const id = pediaId(term, grade, pub, les);
  const lessonURL = `https://pedia.cloud.edu.tw/Bookmark/TCollection?TextNameId=${id}`;
  $('#meta').innerHTML = `<strong>${term}</strong>ï½œ<strong>${grade}</strong>ï½œ<strong>${pub}</strong>ï½œ<a href="${lessonURL}" target="_blank" rel="noopener">ğŸ“– ${les}</a> <span class="note">ï¼ˆ<a href="${lessonURL}" target="_blank" rel="noopener">æ•™è‚²ç™¾ç§‘ï¼šæœ¬èª²ç”Ÿå­—è©å½™è¡¨</a>ï¼‰</span>`;
  $('#stats').textContent = `ã€€å…± ${chars.length} å€‹ç”Ÿå­—`;
  const tbody = $('#result tbody');
  for(const ch of chars){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${ch}</td><td><a href="${idiomLink(ch)}" target="_blank" rel="noopener">æŸ¥ã€Œ${ch}ã€çš„æˆèª</a></td>`;
    tbody.appendChild(tr);
  }
}

// ç¶å®šäº‹ä»¶
$('#term').addEventListener('change', ()=>{ updateGrades(); });
$('#grade').addEventListener('change', ()=>{ updatePublishers(); });
$('#publisher').addEventListener('change', async ()=>{ await updateLessons(); });
$('#lesson').addEventListener('change', render);

// å•Ÿå‹•
init();
</script>
</body>
</html>
